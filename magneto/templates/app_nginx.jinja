upstream upstream_{{app}} {
    {% for node in nodes %}
    server {{node}};
    {% endfor %}

    {% for backup in backups %}
    server {{backup}}   backup;
    {% endfor %}
}

server {
    location / {
        proxy_pass http://upstream_{{app}};
        proxy_redirect     off;
        proxy_set_header   Host             $host;
        proxy_set_header   X-Real-IP        $remote_addr;
        proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
        proxy_connect_timeout      90;
        proxy_send_timeout         90;
        proxy_read_timeout         90;
    }
}
